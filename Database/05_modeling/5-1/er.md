## ER å›³

### è¦ä»¶æ•´ç†

è¨˜äº‹ã¨ã€ãã®ç·¨é›†å±¥æ­´ã‚’ä¿å­˜ã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãƒ–ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚ˆã†ãªã‚‚ã®ï¼‰ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¨­è¨ˆã—ã¦ã€UMLå›³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å‚™ãˆã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚

#### è¨˜äº‹
  1000æ–‡å­—ç¨‹åº¦ã®æœ¬æ–‡ã‚’è¨˜å…¥ã—ã¦ä¿å­˜ã§ãã‚‹
#### è¨˜äº‹ã®å±¥æ­´
  - è¨˜äº‹ã‚’æ›´æ–°ã™ã‚‹ã¨å±¥æ­´ãŒä¿å­˜ã•ã‚Œã‚‹
  - ç‰¹å®šã®è¨˜äº‹ã®å±¥æ­´ã‚’ä¸€è¦§è¡¨ç¤ºã§ãã‚‹
  - å±¥æ­´ã‚’é¸æŠã—ã¦éå»ã®è¨˜äº‹çŠ¶æ…‹ã«æˆ»ã™äº‹ãŒå¯èƒ½

#### è¨˜äº‹ã®é–²è¦§
  æœ€æ–°çŠ¶æ…‹ã®è¨˜äº‹ã‚’ä¸€è¦§è¡¨ç¤ºã§ãã‚‹


### è¨­è¨ˆæ„å›³

- æœ€ä½é™ã®ä»•æ§˜ã®ã¿ã‚’è€ƒæ…®ã™ã‚‹

ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã®æ›´æ–°, æ¨©é™è¨­å®šãªã©"ã‚µãƒ¼ãƒ“ã‚¹çš„ã«å¿…è¦ãã†ãªæ©Ÿèƒ½"ã¯
ä»Šå›æœªå¯¾å¿œã§è¦ä»¶ã®ã¿ã‚’è€ƒæ…®ã¨ã™ã‚‹ã€‚

- å‰Šé™¤ã¯è«–ç†å‰Šé™¤ã®ã¿

ArticleHistories.visibility ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹(draft, published, archived)ã‚’ç®¡ç†ã—ã¦ãŠã‚Š
å‰Šé™¤æ™‚ã¯ã€archivedã«å¤‰æ›´ã™ã‚‹ã®ã¿ã¨ã™ã‚‹ã€‚

- UPDATEã®SQLã¯(ãªã‚‹ã¹ã) é¿ã‘ã‚‹

è¨˜äº‹ã®æ›´æ–°ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ã¿ã€Articles.latest_history_idã‚’UPDATEã§æ›´æ–°ã—ã¦ã„ã¾ã™ã€‚

å–å¾— > æ›´æ–°ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦è¨­è¨ˆã—ãŸå ´åˆã«ã€æœ€æ–°å±¥æ­´ã®å–å¾—æ–¹æ³•ãŒ
Articles.latest_history_idã§ã‚ã‚Œã°ã€JOIN + id ç›´å‚ç…§ã«ãªã‚‹ã®ã«å¯¾ã—
ArticleHistories.created_atã®æœ€æ–°æ—¥æ™‚ã‚’å–å¾—ã™ã‚‹å ´åˆã€ã‚µãƒ–ã‚¯ã‚¨ãƒª + é›†ç´„ã«ãªã£ã¦ã—ã¾ã†ãŸã‚
å–å¾—ã‚±ãƒ¼ã‚¹ã®å¤šã„ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€UPDATEã§å¯¾å¿œã—ã¦ã‚‚ã‚ˆã„ã®ã‹ãªï¼Ÿã¨ã„ã†åˆ¤æ–­ã§ã™ã€‚
(ã§ã™ãŒã€ç·¨é›†ã®ãŸã³ã«UPDATEã—ãªãã‚ƒã„ã‘ãªã„ã®ã¯[usecase.sql](./usecase.sql)ã‚’æ›¸ã„ã¦ã¦å¾®å¦™ã‹ãªã¨æ€ãˆã¦ãã¾ã—ãŸã€‚ã€‚)
â†‘ã”æ„è¦‹ãœã²ã„ãŸã ããŸã„ã§ã™ğŸ™‹


```mermaid
erDiagram
  Users ||--o{ Articles : "ä½œæˆ"
  Users ||--o{ ArticleHistories : "ç·¨é›†"
  Articles ||--o{ ArticleHistories : "å±¥æ­´"

  Users {
    varchar(36) id PK
    string name
    timestamp created_at
  }

  Articles {
    int id PK
    int created_by FK "Users.id"
    varchar(36) latest_history_id FK "History.id"
    timestamp created_at
  }

  ArticleHistories {
    int id PK
    int article_id FK "Articles.id"
    int edited_by FK "Users.id"
    string title
    text body
    enum visibility "draft, published, archived"
    timestamp created_at
  }
```
